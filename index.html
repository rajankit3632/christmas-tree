<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Particle Christmas Tree</title>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrollbars */
            background-color: #000;
            font-family: 'Arial', sans-serif;
        }

        /* Container for the 3D canvas */
        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        /* Text Overlay Styling */
        #overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none; /* Allows mouse to click through text to rotate tree */
            z-index: 10;
        }

        h1 {
            font-family: 'Great Vibes', cursive; /* Fancy script font */
            color: #ffd700; /* Gold */
            font-size: 5rem;
            margin: 0;
            text-shadow: 
                0 0 10px #ffd700,
                0 0 20px #ff8c00,
                0 0 30px #ff0000;
            animation: pulse 3s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        /* Import a fancy font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
    </style>

    <!-- Import Map for Three.js (Modern approach) -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <div id="overlay">
        <h1>Merry Christmas</h1>
    </div>
    
    <div id="canvas-container"></div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Scene Setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        // Add some subtle fog for depth
        scene.fog = new THREE.FogExp2(0x000000, 0.02);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 15);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // 2. Controls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2.0;

        // 3. Helper function to create a "Glow" texture on the fly
        // This avoids needing external image files.
        function createParticleTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = 32;
            const context = canvas.getContext('2d');
            
            // Draw a radial gradient (white center to transparent edge)
            const gradient = context.createRadialGradient(16, 16, 0, 16, 16, 16);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
            gradient.addColorStop(0.2, 'rgba(255, 215, 0, 0.8)'); // Gold tint
            gradient.addColorStop(0.5, 'rgba(255, 215, 0, 0.2)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
            
            context.fillStyle = gradient;
            context.fillRect(0, 0, 32, 32);
            
            const texture = new THREE.CanvasTexture(canvas);
            return texture;
        }

        // 4. Generate the Tree Particles
        const particleCount = 4000;
        const geometry = new THREE.BufferGeometry();
        const positions = [];
        const sizes = [];
        const colors = [];

        const colorObj = new THREE.Color();
        const treeHeight = 15;
        const baseRadius = 5;

        for (let i = 0; i < particleCount; i++) {
            // Normalized height (0 to 1)
            const h = i / particleCount;
            
            // Spiral logic
            const angle = i * 0.15 + (Math.random() * 0.5); // The angle of the spiral
            
            // Radius decreases as height increases (Cone shape)
            // Added some randomness so it's not a perfect line
            const r = (baseRadius * (1 - h)) + (Math.random() * 0.5);

            const x = r * Math.cos(angle);
            const y = (h * treeHeight) - (treeHeight / 2); // Center vertically
            const z = r * Math.sin(angle);

            positions.push(x, y, z);

            // Size variation
            sizes.push(Math.random() * 0.5 + 0.1);

            // Color variation (Gold to reddish-gold)
            // 0xffd700 is Gold
            colorObj.setHSL(0.1 + Math.random() * 0.05, 1.0, 0.5 + Math.random() * 0.3);
            colors.push(colorObj.r, colorObj.g, colorObj.b);
        }

        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
        geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

        // 5. Material
        const material = new THREE.PointsMaterial({
            size: 0.3,
            map: createParticleTexture(),
            transparent: true,
            opacity: 0.9,
            vertexColors: true, // Use the colors array we generated
            blending: THREE.AdditiveBlending, // Makes overlapping particles glow brighter
            depthWrite: false // Prevents particles from occluding each other weirdly
        });

        const tree = new THREE.Points(geometry, material);
        scene.add(tree);

        // Add a "Star" at the top
        const starGeo = new THREE.BufferGeometry();
        starGeo.setAttribute('position', new THREE.Float32BufferAttribute([0, treeHeight/2 + 0.5, 0], 3));
        const starMat = new THREE.PointsMaterial({
            size: 1.5,
            map: createParticleTexture(),
            color: 0xffffff,
            transparent: true,
            blending: THREE.AdditiveBlending,
            depthWrite: false
        });
        const star = new THREE.Points(starGeo, starMat);
        scene.add(star);

        // 6. Animation Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            
            const time = clock.getElapsedTime();

            // Rotate the entire tree slightly for extra movement aside from OrbitControls
            // tree.rotation.y = time * 0.1; 
            
            // Make particles "twinkle" by slightly scaling size (optional visual flair)
            // Note: updating attributes is expensive, so we'll just rely on the rotation 
            // and additive blending for the shimmer effect.

            controls.update(); // Required if damping is enabled
            renderer.render(scene, camera);
        }

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>